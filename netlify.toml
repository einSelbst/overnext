[build]
command = "npm run build"
publish = ".next"

  [build.environment]
  CI = "1"
  # cache Cypress binary in local "node_modules" folder
  # so Netlify caches it
  # CYPRESS_CACHE_FOLDER = "./node_modules/CypressBinary"
  # set TERM variable for terminal output
  TERM = "xterm"

# If skip_processing = true, all other settings are ignored
  [build.processing]
  skip_processing = false
  [build.processing.css]
  bundle = true
  minify = false
  [build.processing.js]
  bundle = true
  minify = false
  [build.processing.html]
  pretty_urls = true
  [build.processing.images]
  compress = true

[context.production.environment]
NEXT_SERVERLESS = "true"
NODE_ENV = "production"

[context.server.environment]
NEXT_SERVERLESS = "false"
NODE_ENV = "production"

[[plugins]]
package = "@netlify/plugin-nextjs"

[[plugins]]
package = "netlify-plugin-cache-nextjs"

[[plugins]]
# runs Cypress tests against the deployed URL
package = "netlify-plugin-cypress"

  [plugins.inputs]
  record = true
  spec = "cypress/integration/smoke/*.js"

# pa11y config
[[plugins]]
package = "netlify-plugin-a11y"

  [plugins.inputs]
  checkPaths = ['/',]

  # optional config
  # ignoreDirectories = ['/admin']  # explicitly ignore these directories

  # resultMode = "warn" # is "error" by default

[[plugins]]
  package = "netlify-plugin-html-validate"

# # lighthouse config
# [[plugins]]
# package = "@netlify/plugin-lighthouse"

#   # optional, fails build when a category is below a threshold
#   [plugins.inputs.thresholds]
#   performance = 0.9
#   accessibility = 0.9
#   best-practices = 0.9
#   seo = 0.8

#   [[plugins.inputs.audits]]
#   path = "de/legal"
#   [[plugins.inputs.audits]]
#   path = "first-amp"
#     [plugins.inputs.audits.thresholds]
#     performance = 0.8
